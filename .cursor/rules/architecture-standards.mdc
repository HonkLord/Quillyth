# ğŸ—ï¸ **Modular Architecture Standards**

## ğŸ“ **Folder Structure Convention**

### **Feature-Based Organization**

```
js/
â”œâ”€â”€ features/                    # Feature modules (NEW STANDARD)
â”‚   â”œâ”€â”€ sessions/               # Session management feature
â”‚   â”‚   â”œâ”€â”€ session-core.js     # Data management & CRUD
â”‚   â”‚   â”œâ”€â”€ session-planner.js  # Complex business logic
â”‚   â”‚   â”œâ”€â”€ session-ui.js       # UI rendering & interactions
â”‚   â”‚   â””â”€â”€ session-manager.js  # Feature coordinator
â”‚   â”œâ”€â”€ characters/             # Character management feature
â”‚   â”‚   â”œâ”€â”€ character-core.js   # Data management & CRUD
â”‚   â”‚   â”œâ”€â”€ character-progression.js  # Progression tracking
â”‚   â”‚   â”œâ”€â”€ character-relationships.js # Relationship management
â”‚   â”‚   â”œâ”€â”€ character-ui.js     # UI rendering & interactions
â”‚   â”‚   â””â”€â”€ character-manager.js # Feature coordinator
â”‚   â”œâ”€â”€ scenes/                 # Scene management (already modular)
â”‚   â”‚   â”œâ”€â”€ scene-data-manager.js
â”‚   â”‚   â”œâ”€â”€ scene-renderer.js
â”‚   â”‚   â”œâ”€â”€ scene-ui.js
â”‚   â”‚   â””â”€â”€ scene-manager.js
â”‚   â”œâ”€â”€ quests/                 # Quest management feature
â”‚   â”œâ”€â”€ locations/              # Location management feature
â”‚   â””â”€â”€ notes/                  # Notes management feature
â”œâ”€â”€ shared/                     # Shared utilities and services
â”‚   â”œâ”€â”€ api-service.js          # API communication
â”‚   â”œâ”€â”€ data-manager.js         # Cross-feature data operations
â”‚   â”œâ”€â”€ notification-service.js # Toast notifications, etc.
â”‚   â””â”€â”€ validation-service.js   # Data validation utilities
â”œâ”€â”€ services/                   # External service integrations
â”‚   â”œâ”€â”€ gemini-service.js       # AI service integration
â”‚   â”œâ”€â”€ search-service.js       # Search functionality
â”‚   â””â”€â”€ export-import-service.js # Data export/import
â”œâ”€â”€ components/                 # Reusable UI components
â”‚   â”œâ”€â”€ global-search.js        # Cross-feature search component
â”‚   â””â”€â”€ export-import-panel.js  # Cross-feature export panel
â””â”€â”€ app.js                      # Main application coordinator
```

## ğŸ§© **Module Responsibility Pattern**

### **Core Module** (`*-core.js`)

- **Responsibility**: Data management, CRUD operations, business logic
- **Size Limit**: 200-300 lines
- **Contains**:
  - API calls and data fetching
  - Data validation and transformation
  - Basic business rules
  - State management for the feature

### **Specialized Modules** (`*-planner.js`, `*-progression.js`, etc.)

- **Responsibility**: Complex business logic for specific aspects
- **Size Limit**: 300-400 lines
- **Contains**:
  - Advanced algorithms and calculations
  - Complex workflows
  - Feature-specific business rules

### **UI Module** (`*-ui.js`)

- **Responsibility**: User interface rendering and interactions
- **Size Limit**: 300-400 lines
- **Contains**:
  - HTML template generation
  - Event handling
  - UI state management
  - Modal and form management

### **Manager Module** (`*-manager.js`)

- **Responsibility**: Feature coordination and public API
- **Size Limit**: 200-300 lines
- **Contains**:
  - Module initialization and coordination
  - Public methods for other features to use
  - High-level workflow orchestration
  - Integration with other features

## ğŸ“ **File Size Guidelines**

### **Strict Limits**

- **Maximum file size**: 500 lines (NEVER exceed)
- **Optimal file size**: 200-300 lines
- **Refactor trigger**: 400+ lines

### **When to Split Files**

```javascript
// âŒ BAD: One massive file
class CharacterManager {
  // 3,573 lines of mixed responsibilities
}

// âœ… GOOD: Modular approach
class CharacterCore {        // 250 lines - data management
class CharacterProgression { // 300 lines - progression logic
class CharacterUI {          // 350 lines - UI rendering
class CharacterManager {     // 200 lines - coordination
```

## ğŸ”— **Import/Export Standards**

### **Feature Module Exports**

```javascript
// Core module - default export
export default class SessionCore { }

// Specialized modules - named exports
export class SessionPlanner { }
export class SessionUI { }

// Manager - default export (main feature interface)
export default class SessionManager { }
```

### **Import Patterns**

```javascript
// Manager imports (feature coordinator)
import SessionCore from './session-core.js';
import { SessionPlanner } from './session-planner.js';
import { SessionUI } from './session-ui.js';

// Cross-feature imports
import { ApiService } from '../../shared/api-service.js';
import { NotificationService } from '../../shared/notification-service.js';
```

## ğŸ¯ **Naming Conventions**

### **File Naming**

- **Core modules**: `feature-core.js` (e.g., `session-core.js`)
- **Specialized modules**: `feature-aspect.js` (e.g., `character-progression.js`)
- **UI modules**: `feature-ui.js` (e.g., `quest-ui.js`)
- **Managers**: `feature-manager.js` (e.g., `location-manager.js`)

### **Class Naming**

- **Core classes**: `FeatureCore` (e.g., `SessionCore`)
- **Specialized classes**: `FeatureAspect` (e.g., `CharacterProgression`)
- **UI classes**: `FeatureUI` (e.g., `QuestUI`)
- **Managers**: `FeatureManager` (e.g., `LocationManager`)

## ğŸ”„ **Migration Strategy**

### **Step 1: Create Feature Directory**

```bash
mkdir -p js/features/[feature-name]
```

### **Step 2: Extract Core Module**

- Move basic CRUD operations
- Move data management logic
- Keep API calls and state management

### **Step 3: Extract Specialized Modules**

- Identify complex business logic areas
- Create focused modules for each aspect
- Move related functionality together

### **Step 4: Extract UI Module**

- Move HTML generation
- Move event handling
- Move modal management

### **Step 5: Create Lean Manager**

- Keep only coordination logic
- Import and initialize modules
- Provide public API for other features

### **Step 6: Update Imports**

- Update app.js imports
- Update cross-feature references
- Test all functionality

## âœ… **Quality Standards**

### **Before Creating Any File**

- [ ] File has single, clear responsibility
- [ ] File size is under 500 lines
- [ ] Follows naming conventions
- [ ] Has proper imports/exports
- [ ] Includes JSDoc comments for public methods

### **Before Committing Modular Changes**

- [ ] All modules follow size limits
- [ ] Import paths are correct
- [ ] Feature still works as before
- [ ] No functionality is lost
- [ ] Cross-feature integration works
- [ ] Documentation is updated

## ğŸš¨ **Anti-Patterns to Avoid**

### **File Organization**

- âŒ Mixing different responsibilities in one file
- âŒ Creating files over 500 lines
- âŒ Using generic names like `utils.js` or `helpers.js`
- âŒ Putting feature-specific code in shared directories

### **Module Design**

- âŒ Circular dependencies between modules
- âŒ Direct database access from UI modules
- âŒ Business logic in UI modules
- âŒ UI code in core modules

### **Import/Export**

- âŒ Default exports for specialized modules
- âŒ Named exports for main managers
- âŒ Importing entire features when only one method is needed
- âŒ Deep import paths (more than 3 levels)

---

**This standard ensures consistent, maintainable, and scalable code organization across all features.**
description:
globs:
alwaysApply: false
---
